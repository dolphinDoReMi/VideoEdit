<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script> window.FontAwesomeConfig = { autoReplaceSvg: 'nest'};</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>::-webkit-scrollbar { display: none;} * { font-family: 'Inter', sans-serif; }</style>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { dark: { 900:'#0a0a0a',800:'#1a1a1a',700:'#2a2a2a',600:'#3a3a3a' }}}}
    }
  </script>
</head>
<body class="bg-dark-900 text-white overflow-x-hidden">

<!-- Status Bar -->
<div id="status-bar" class="flex justify-between items-center px-4 py-2 bg-dark-800 text-xs text-gray-300">
  <div class="flex items-center space-x-1">
    <div class="w-1 h-1 bg-white rounded-full"></div>
    <div class="w-1 h-1 bg-white rounded-full"></div>
    <div class="w-1 h-1 bg-gray-600 rounded-full"></div>
    <span class="ml-2">Verizon</span>
  </div>
  <div class="font-medium">9:41</div>
  <div class="flex items-center space-x-1">
    <i class="fa-solid fa-signal text-xs"></i>
    <i class="fa-solid fa-wifi text-xs"></i>
    <div class="w-6 h-3 border border-white rounded-sm"><div class="w-4 h-2 bg-white rounded-sm m-0.5"></div></div>
  </div>
</div>

<!-- App Header -->
<div id="app-header" class="flex items-center justify-between px-6 py-4 bg-dark-800 border-b border-dark-600">
  <div class="flex items-center space-x-3">
    <button id="back-btn" class="w-8 h-8 bg-dark-600 rounded-full flex items-center justify-center">
      <i class="fa-solid fa-arrow-left text-gray-300 text-sm"></i>
    </button>
    <div>
      <h1 class="text-lg font-semibold text-white">Whisper Results</h1>
      <p class="text-xs text-gray-400">Analysis Complete</p>
    </div>
  </div>
  <div class="flex items-center space-x-3">
    <div class="flex items-center space-x-2">
      <div class="w-2 h-2 bg-green-500 rounded-full"></div>
      <span class="text-sm text-green-400 font-medium">Complete</span>
    </div>
    <button class="w-8 h-8 bg-dark-600 rounded-full flex items-center justify-center">
      <i class="fa-solid fa-ellipsis-vertical text-gray-300 text-sm"></i>
    </button>
  </div>
</div>

<!-- Job Summary -->
<div id="job-summary" class="px-6 pt-6">
  <div class="bg-gradient-to-r from-green-600 to-blue-600 rounded-2xl p-6 mb-6 border border-dark-600">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold text-white">Job Complete</h2>
      <div class="flex items-center space-x-2">
        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
        <span class="text-sm text-green-400 font-medium">Success</span>
      </div>
    </div>
    <div class="grid grid-cols-2 gap-4 text-sm">
      <div>
        <p class="text-gray-300">Job ID</p>
        <p class="text-white font-medium" id="job-id-display">job_demo_001</p>
      </div>
      <div>
        <p class="text-gray-300">Duration</p>
        <p class="text-white font-medium" id="job-duration">2:34</p>
      </div>
      <div>
        <p class="text-gray-300">RTF</p>
        <p class="text-white font-medium" id="job-rtf">0.056</p>
      </div>
      <div>
        <p class="text-gray-300">Model</p>
        <p class="text-white font-medium" id="job-model">ggml-base.en.bin</p>
      </div>
    </div>
  </div>
</div>

<!-- Results Overview -->
<div id="results-overview" class="px-6 mb-6">
  <h3 class="text-lg font-semibold text-white mb-4">Results Overview</h3>
  <div class="grid grid-cols-3 gap-3 mb-6">
    <div class="bg-dark-700 rounded-xl p-4 border border-dark-600">
      <div class="text-center">
        <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center mx-auto mb-2">
          <i class="fa-solid fa-file-text text-purple-400"></i>
        </div>
        <p class="text-2xl font-bold text-white" id="stat-segments">12</p>
        <p class="text-xs text-gray-400">Segments</p>
      </div>
    </div>
    <div class="bg-dark-700 rounded-xl p-4 border border-dark-600">
      <div class="text-center">
        <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center mx-auto mb-2">
          <i class="fa-solid fa-clock text-blue-400"></i>
        </div>
        <p class="text-2xl font-bold text-white" id="stat-processing">7.2s</p>
        <p class="text-xs text-gray-400">Processing</p>
      </div>
    </div>
    <div class="bg-dark-700 rounded-xl p-4 border border-dark-600">
      <div class="text-center">
        <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center mx-auto mb-2">
          <i class="fa-solid fa-check-circle text-green-400"></i>
        </div>
        <p class="text-2xl font-bold text-white" id="stat-confidence">94.7%</p>
        <p class="text-xs text-gray-400">Confidence</p>
      </div>
    </div>
  </div>
</div>

<!-- Transcript Display -->
<div id="transcript-section" class="px-6 mb-6">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-lg font-semibold text-white">Transcript</h3>
    <div class="flex items-center space-x-2">
      <button id="copy-transcript-btn" class="px-3 py-2 bg-dark-600 rounded-lg text-sm">
        <i class="fa-solid fa-copy mr-2"></i>Copy
      </button>
      <button id="export-transcript-btn" class="px-3 py-2 bg-purple-600 rounded-lg text-sm">
        <i class="fa-solid fa-download mr-2"></i>Export
      </button>
    </div>
  </div>
  
  <div class="bg-dark-700 rounded-xl p-4 border border-dark-600">
    <div id="transcript-content" class="space-y-3 max-h-64 overflow-y-auto">
      <!-- Sample transcript segments -->
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">00:00</div>
        <div class="flex-1">
          <p class="text-white text-sm">We launched the spring campaign with a focus on digital engagement.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">00:15</div>
        <div class="flex-1">
          <p class="text-white text-sm">The results exceeded our expectations across all channels.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">00:32</div>
        <div class="flex-1">
          <p class="text-white text-sm">Customer engagement grew by forty percent compared to last quarter.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">00:48</div>
        <div class="flex-1">
          <p class="text-white text-sm">Social media interactions reached an all-time high.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">01:05</div>
        <div class="flex-1">
          <p class="text-white text-sm">The campaign successfully increased brand awareness.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">01:22</div>
        <div class="flex-1">
          <p class="text-white text-sm">We're planning to expand this strategy to other markets.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">01:38</div>
        <div class="flex-1">
          <p class="text-white text-sm">The team is excited about the future opportunities.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">01:55</div>
        <div class="flex-1">
          <p class="text-white text-sm">Thank you for watching our campaign overview.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Export Options -->
<div id="export-options" class="px-6 mb-6">
  <h3 class="text-lg font-semibold text-white mb-4">Export Options</h3>
  <div class="grid grid-cols-2 gap-3">
    <button id="export-json-btn" class="bg-dark-700 rounded-xl p-4 border border-dark-600 flex items-center justify-between hover:bg-dark-600 transition-colors">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-file-code text-purple-400"></i>
        </div>
        <div class="text-left">
          <p class="text-white font-medium">JSON Export</p>
          <p class="text-gray-400 text-sm">Structured data</p>
        </div>
      </div>
      <i class="fa-solid fa-chevron-right text-gray-400"></i>
    </button>
    
    <button id="export-srt-btn" class="bg-dark-700 rounded-xl p-4 border border-dark-600 flex items-center justify-between hover:bg-dark-600 transition-colors">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-closed-captioning text-blue-400"></i>
        </div>
        <div class="text-left">
          <p class="text-white font-medium">SRT Subtitles</p>
          <p class="text-gray-400 text-sm">Video subtitles</p>
        </div>
      </div>
      <i class="fa-solid fa-chevron-right text-gray-400"></i>
    </button>
    
    <button id="export-txt-btn" class="bg-dark-700 rounded-xl p-4 border border-dark-600 flex items-center justify-between hover:bg-dark-600 transition-colors">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-file-lines text-green-400"></i>
        </div>
        <div class="text-left">
          <p class="text-white font-medium">Plain Text</p>
          <p class="text-gray-400 text-sm">Clean transcript</p>
        </div>
      </div>
      <i class="fa-solid fa-chevron-right text-gray-400"></i>
    </button>
    
    <button id="export-all-btn" class="bg-gradient-to-r from-purple-600 to-pink-600 rounded-xl p-4 border border-dark-600 flex items-center justify-between hover:from-purple-700 hover:to-pink-700 transition-colors">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-download text-white"></i>
        </div>
        <div class="text-left">
          <p class="text-white font-medium">Export All</p>
          <p class="text-gray-400 text-sm">Complete package</p>
        </div>
      </div>
      <i class="fa-solid fa-chevron-right text-white"></i>
    </button>
  </div>
</div>

<!-- Processing Details -->
<div id="processing-details" class="px-6 mb-6">
  <h3 class="text-lg font-semibold text-white mb-4">Processing Details</h3>
  <div class="bg-dark-700 rounded-xl p-4 border border-dark-600">
    <div class="space-y-3">
      <div class="flex items-center justify-between">
        <span class="text-gray-300 text-sm">Audio Duration</span>
        <span class="text-white text-sm">2:34</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-gray-300 text-sm">Processing Time</span>
        <span class="text-white text-sm">7.2 seconds</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-gray-300 text-sm">Real-time Factor</span>
        <span class="text-white text-sm">0.056</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-gray-300 text-sm">Model Used</span>
        <span class="text-white text-sm">ggml-base.en.bin</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-gray-300 text-sm">Language Detected</span>
        <span class="text-white text-sm">English</span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-gray-300 text-sm">Confidence Score</span>
        <span class="text-white text-sm">94.7%</span>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div id="quick-actions" class="px-6 mb-8">
  <h3 class="text-lg font-semibold text-white mb-4">Quick Actions</h3>
  <div class="grid grid-cols-1 gap-3">
    <button id="new-analysis-btn" class="bg-dark-700 rounded-xl p-4 border border-dark-600 flex items-center justify-between hover:bg-dark-600 transition-colors">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-plus text-purple-400"></i>
        </div>
        <div class="text-left">
          <p class="text-white font-medium">New Analysis</p>
          <p class="text-gray-400 text-sm">Start another transcription</p>
        </div>
      </div>
      <i class="fa-solid fa-chevron-right text-gray-400"></i>
    </button>
    
    <button id="view-history-btn" class="bg-dark-700 rounded-xl p-4 border border-dark-600 flex items-center justify-between hover:bg-dark-600 transition-colors">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-history text-blue-400"></i>
        </div>
        <div class="text-left">
          <p class="text-white font-medium">View History</p>
          <p class="text-gray-400 text-sm">Browse past analyses</p>
        </div>
      </div>
      <i class="fa-solid fa-chevron-right text-gray-400"></i>
    </button>
    
    <button id="settings-btn" class="bg-dark-700 rounded-xl p-4 border border-dark-600 flex items-center justify-between hover:bg-dark-600 transition-colors">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
          <i class="fa-solid fa-cog text-green-400"></i>
        </div>
        <div class="text-left">
          <p class="text-white font-medium">Settings</p>
          <p class="text-gray-400 text-sm">Configure preferences</p>
        </div>
      </div>
      <i class="fa-solid fa-chevron-right text-gray-400"></i>
    </button>
  </div>
</div>

<!-- Bottom Navigation -->
<div id="bottom-navigation" class="fixed bottom-0 left-0 right-0 bg-dark-800 border-t border-dark-600 px-6 py-3 pb-[env(safe-area-inset-bottom)]">
  <div class="flex items-center justify-between">
    <button class="flex flex-col items-center space-y-1 text-gray-400">
      <i class="fa-solid fa-home text-lg"></i>
      <span class="text-xs font-medium">Home</span>
    </button>
    <button class="flex flex-col items-center space-y-1 text-gray-400">
      <i class="fa-solid fa-compass text-lg"></i>
      <span class="text-xs font-medium">Explore</span>
    </button>
    <button class="flex flex-col items-center space-y-1 text-purple-400">
      <i class="fa-solid fa-check-circle text-lg"></i>
      <span class="text-xs font-medium">Results</span>
    </button>
    <button class="flex flex-col items-center space-y-1 text-gray-400">
      <i class="fa-solid fa-search text-lg"></i>
      <span class="text-xs font-medium">Search</span>
    </button>
    <button class="flex flex-col items-center space-y-1 text-gray-400">
      <i class="fa-solid fa-user text-lg"></i>
      <span class="text-xs font-medium">Profile</span>
    </button>
  </div>
</div>

<script>
/* ===================== WHISPER STEP 3: RESULTS & EXPORT ===================== */

(() => {
  // State management
  const state = {
    jobId: 'job_demo_001',
    duration: '2:34',
    rtf: '0.056',
    model: 'ggml-base.en.bin',
    segments: 12,
    processingTime: '7.2s',
    confidence: '94.7%'
  };

  // Sample transcript data
  const transcriptData = {
    segments: [
      { start: '00:00', text: 'We launched the spring campaign with a focus on digital engagement.' },
      { start: '00:15', text: 'The results exceeded our expectations across all channels.' },
      { start: '00:32', text: 'Customer engagement grew by forty percent compared to last quarter.' },
      { start: '00:48', text: 'Social media interactions reached an all-time high.' },
      { start: '01:05', text: 'The campaign successfully increased brand awareness.' },
      { start: '01:22', text: 'We\'re planning to expand this strategy to other markets.' },
      { start: '01:38', text: 'The team is excited about the future opportunities.' },
      { start: '01:55', text: 'Thank you for watching our campaign overview.' }
    ],
    metadata: {
      jobId: state.jobId,
      duration: state.duration,
      rtf: state.rtf,
      model: state.model,
      confidence: state.confidence,
      language: 'English',
      createdAt: new Date().toISOString()
    }
  };

  // Bridge contract (if running in Android WebView)
  const hasBridge = typeof window.AndroidWhisper !== 'undefined';
  const bridge = hasBridge ? {
    async exportJson(jobId) { return window.AndroidWhisper.exportJson(jobId); },
    async exportSrt(jobId) { return window.AndroidWhisper.exportSrt(jobId); },
    async exportTxt(jobId) { return window.AndroidWhisper.exportTxt(jobId); },
    async exportAll(jobId) { return window.AndroidWhisper.exportAll(jobId); },
    async goBack() { return window.AndroidWhisper.goBack(); },
    async newAnalysis() { return window.AndroidWhisper.newAnalysis(); }
  } : mockBridge();

  function mockBridge() {
    return {
      async exportJson(jobId) { 
        console.log('Mock: Exporting JSON for', jobId);
        downloadFile('transcript.json', JSON.stringify(transcriptData, null, 2));
        return 'ok';
      },
      async exportSrt(jobId) { 
        console.log('Mock: Exporting SRT for', jobId);
        const srt = generateSRT(transcriptData.segments);
        downloadFile('transcript.srt', srt);
        return 'ok';
      },
      async exportTxt(jobId) { 
        console.log('Mock: Exporting TXT for', jobId);
        const txt = transcriptData.segments.map(s => s.text).join(' ');
        downloadFile('transcript.txt', txt);
        return 'ok';
      },
      async exportAll(jobId) { 
        console.log('Mock: Exporting all formats for', jobId);
        await this.exportJson(jobId);
        await this.exportSrt(jobId);
        await this.exportTxt(jobId);
        return 'ok';
      },
      async goBack() { 
        console.log('Mock: Going back to previous step');
        if (window.AndroidInterface) {
          window.AndroidInterface.goBack();
        }
        return 'ok';
      },
      async newAnalysis() { 
        console.log('Mock: Starting new analysis');
        if (window.AndroidInterface) {
          window.AndroidInterface.openWhisperStep2();
        }
        return 'ok';
      }
    };
  }

  // Utility functions
  function downloadFile(filename, content) {
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    URL.revokeObjectURL(url);
  }

  function generateSRT(segments) {
    return segments.map((segment, index) => {
      const startTime = formatSRTTime(segment.start);
      const endTime = formatSRTTime(calculateEndTime(segment.start, segment.text));
      return `${index + 1}\n${startTime} --> ${endTime}\n${segment.text}\n`;
    }).join('\n');
  }

  function formatSRTTime(timeStr) {
    // Convert "00:15" to "00:00:15,000"
    const [minutes, seconds] = timeStr.split(':');
    return `00:${minutes.padStart(2, '0')}:${seconds.padStart(2, '0')},000`;
  }

  function calculateEndTime(startTime, text) {
    // Simple estimation: ~150 words per minute
    const wordCount = text.split(' ').length;
    const durationSeconds = Math.max(2, Math.round(wordCount * 0.4)); // ~2.5 words per second
    const [minutes, seconds] = startTime.split(':').map(Number);
    const totalSeconds = minutes * 60 + seconds + durationSeconds;
    const newMinutes = Math.floor(totalSeconds / 60);
    const newSeconds = totalSeconds % 60;
    return `${newMinutes.toString().padStart(2, '0')}:${newSeconds.toString().padStart(2, '0')}`;
  }

  function toast(message, isError = false) {
    const toast = document.createElement('div');
    toast.className = `fixed bottom-20 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg text-sm ${
      isError ? 'bg-red-600' : 'bg-dark-600'
    } border border-dark-500`;
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2000);
  }

  // Event handlers
  document.getElementById('back-btn').onclick = async () => {
    try {
      await bridge.goBack();
    } catch (e) {
      toast(`Back failed: ${e.message}`, true);
    }
  };

  document.getElementById('copy-transcript-btn').onclick = async () => {
    try {
      const text = transcriptData.segments.map(s => s.text).join(' ');
      await navigator.clipboard.writeText(text);
      toast('Transcript copied to clipboard');
    } catch (e) {
      toast('Copy failed', true);
    }
  };

  document.getElementById('export-transcript-btn').onclick = async () => {
    try {
      await bridge.exportTxt(state.jobId);
      toast('Transcript exported');
    } catch (e) {
      toast(`Export failed: ${e.message}`, true);
    }
  };

  document.getElementById('export-json-btn').onclick = async () => {
    try {
      await bridge.exportJson(state.jobId);
      toast('JSON exported');
    } catch (e) {
      toast(`Export failed: ${e.message}`, true);
    }
  };

  document.getElementById('export-srt-btn').onclick = async () => {
    try {
      await bridge.exportSrt(state.jobId);
      toast('SRT exported');
    } catch (e) {
      toast(`Export failed: ${e.message}`, true);
    }
  };

  document.getElementById('export-txt-btn').onclick = async () => {
    try {
      await bridge.exportTxt(state.jobId);
      toast('Text exported');
    } catch (e) {
      toast(`Export failed: ${e.message}`, true);
    }
  };

  document.getElementById('export-all-btn').onclick = async () => {
    try {
      await bridge.exportAll(state.jobId);
      toast('All formats exported');
    } catch (e) {
      toast(`Export failed: ${e.message}`, true);
    }
  };

  document.getElementById('new-analysis-btn').onclick = async () => {
    try {
      await bridge.newAnalysis();
    } catch (e) {
      toast(`New analysis failed: ${e.message}`, true);
    }
  };

  document.getElementById('view-history-btn').onclick = () => {
    toast('History view coming soon');
  };

  document.getElementById('settings-btn').onclick = () => {
    toast('Settings coming soon');
  };

  // Initialize display
  document.getElementById('job-id-display').textContent = state.jobId;
  document.getElementById('job-duration').textContent = state.duration;
  document.getElementById('job-rtf').textContent = state.rtf;
  document.getElementById('job-model').textContent = state.model;
  document.getElementById('stat-segments').textContent = state.segments;
  document.getElementById('stat-processing').textContent = state.processingTime;
  document.getElementById('stat-confidence').textContent = state.confidence;

  console.log('Whisper Step 3 initialized');
})();
</script>

</body>
</html>
