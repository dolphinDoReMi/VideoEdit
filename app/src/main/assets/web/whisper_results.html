<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script> window.FontAwesomeConfig = { autoReplaceSvg: 'nest' };</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    ::-webkit-scrollbar { display: none; }
    * { font-family: 'Inter', sans-serif; }
    @media (prefers-reduced-motion: reduce) { .animate-pulse { animation: none !important; } }
  </style>
  <script>
    tailwind.config = {
      theme: { 
        extend: { 
          colors: { 
            dark: { 900:'#0a0a0a', 800:'#1a1a1a', 700:'#2a2a2a', 600:'#3a3a3a' }
          }
        }
      }
    }
  </script>
</head>
<body class="bg-dark-900 text-white overflow-x-hidden">

<!-- Status Bar -->
<div id="status-bar" class="flex justify-between items-center px-4 py-2 bg-dark-800 text-xs text-gray-300">
  <div class="flex items-center space-x-1">
    <div class="w-1 h-1 bg-white rounded-full"></div>
    <div class="w-1 h-1 bg-white rounded-full"></div>
    <div class="w-1 h-1 bg-gray-600 rounded-full"></div>
    <span class="ml-2">Verizon</span>
  </div>
  <div class="font-medium">9:41</div>
  <div class="flex items-center space-x-1">
    <i class="fa-solid fa-signal text-xs"></i>
    <i class="fa-solid fa-wifi text-xs"></i>
    <div class="w-6 h-3 border border-white rounded-sm"><div class="w-4 h-2 bg-white rounded-sm m-0.5"></div></div>
  </div>
</div>

<!-- App Header -->
<div id="app-header" class="flex items-center justify-between px-6 py-4 bg-dark-800 border-b border-dark-600">
  <div class="flex items-center space-x-3">
    <button id="back-btn" class="w-8 h-8 bg-dark-600 rounded-full flex items-center justify-center">
      <i class="fa-solid fa-arrow-left text-gray-300 text-sm"></i>
    </button>
    <div>
      <h1 class="text-lg font-semibold text-white">Whisper Results</h1>
      <p class="text-xs text-gray-400">Analysis Complete</p>
    </div>
  </div>
  <div class="flex items-center space-x-3">
    <div class="flex items-center space-x-2">
      <div class="w-2 h-2 bg-green-500 rounded-full"></div>
      <span class="text-sm text-green-400 font-medium">Complete</span>
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="px-6 py-6 pb-24">
  
  <!-- Job Summary -->
  <div class="bg-gradient-to-r from-green-600 to-blue-600 rounded-2xl p-6 mb-6 border border-dark-600">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold text-white">Processing Complete</h2>
      <div class="flex items-center space-x-2">
        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
        <span class="text-sm text-green-400 font-medium">Success</span>
      </div>
    </div>
    <div class="grid grid-cols-2 gap-4 text-sm">
      <div>
        <p class="text-gray-300">Job ID</p>
        <p class="text-white font-medium" id="job-id-display">job_demo_001</p>
      </div>
      <div>
        <p class="text-gray-300">Duration</p>
        <p class="text-white font-medium" id="job-duration">2:34</p>
      </div>
      <div>
        <p class="text-gray-300">Processing Time</p>
        <p class="text-white font-medium" id="job-processing">7.2s</p>
      </div>
      <div>
        <p class="text-gray-300">Confidence</p>
        <p class="text-white font-medium" id="job-confidence">94.7%</p>
      </div>
    </div>
  </div>

  <!-- Results Overview -->
  <div class="bg-dark-700 rounded-2xl p-6 border border-dark-600 mb-6">
    <h3 class="text-lg font-semibold text-white mb-4">Results Overview</h3>
    <div class="grid grid-cols-3 gap-4">
      <div class="text-center">
        <div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center mx-auto mb-2">
          <i class="fa-solid fa-file-text text-purple-400 text-lg"></i>
        </div>
        <p class="text-2xl font-bold text-white" id="stat-segments">12</p>
        <p class="text-xs text-gray-400">Segments</p>
      </div>
      <div class="text-center">
        <div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center mx-auto mb-2">
          <i class="fa-solid fa-clock text-blue-400 text-lg"></i>
        </div>
        <p class="text-2xl font-bold text-white" id="stat-processing">7.2s</p>
        <p class="text-xs text-gray-400">Processing</p>
      </div>
      <div class="text-center">
        <div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center mx-auto mb-2">
          <i class="fa-solid fa-check-circle text-green-400 text-lg"></i>
        </div>
        <p class="text-2xl font-bold text-white" id="stat-confidence">94.7%</p>
        <p class="text-xs text-gray-400">Confidence</p>
      </div>
    </div>
  </div>

  <!-- Transcript Display -->
  <div class="bg-dark-700 rounded-2xl p-6 border border-dark-600 mb-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-lg font-semibold text-white">Transcript</h3>
      <button id="copy-transcript-btn" class="px-3 py-2 bg-dark-600 hover:bg-dark-600/80 rounded-lg text-sm transition-colors">
        <i class="fa-solid fa-copy mr-2"></i>Copy
      </button>
    </div>
    
    <div id="transcript-content" class="space-y-3 max-h-64 overflow-y-auto">
      <!-- Sample transcript segments -->
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">00:00</div>
        <div class="flex-1">
          <p class="text-white text-sm">We launched the spring campaign with a focus on digital engagement.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">00:15</div>
        <div class="flex-1">
          <p class="text-white text-sm">The results exceeded our expectations across all channels.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">00:32</div>
        <div class="flex-1">
          <p class="text-white text-sm">Customer engagement grew by forty percent compared to last quarter.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">00:48</div>
        <div class="flex-1">
          <p class="text-white text-sm">Social media interactions reached an all-time high.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">01:05</div>
        <div class="flex-1">
          <p class="text-white text-sm">The campaign successfully increased brand awareness.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">01:22</div>
        <div class="flex-1">
          <p class="text-white text-sm">We're planning to expand this strategy to other markets.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">01:38</div>
        <div class="flex-1">
          <p class="text-white text-sm">The team is excited about the future opportunities.</p>
        </div>
      </div>
      <div class="flex items-start space-x-3">
        <div class="w-16 text-xs text-gray-400 mt-1">01:55</div>
        <div class="flex-1">
          <p class="text-white text-sm">Thank you for watching our campaign overview.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Export Options -->
  <div class="bg-dark-700 rounded-2xl p-6 border border-dark-600 mb-6">
    <h3 class="text-lg font-semibold text-white mb-4">Export Results</h3>
    <div class="grid grid-cols-2 gap-3">
      <button id="export-json-btn" class="bg-dark-600 hover:bg-dark-600/80 rounded-xl p-4 border border-dark-500 flex items-center justify-center space-x-3 transition-colors">
        <i class="fa-solid fa-file-code text-purple-400 text-lg"></i>
        <span class="text-white font-medium">JSON</span>
      </button>
      
      <button id="export-srt-btn" class="bg-dark-600 hover:bg-dark-600/80 rounded-xl p-4 border border-dark-500 flex items-center justify-center space-x-3 transition-colors">
        <i class="fa-solid fa-closed-captioning text-blue-400 text-lg"></i>
        <span class="text-white font-medium">SRT</span>
      </button>
      
      <button id="export-txt-btn" class="bg-dark-600 hover:bg-dark-600/80 rounded-xl p-4 border border-dark-500 flex items-center justify-center space-x-3 transition-colors">
        <i class="fa-solid fa-file-lines text-green-400 text-lg"></i>
        <span class="text-white font-medium">TXT</span>
      </button>
      
      <button id="export-all-btn" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 rounded-xl p-4 border border-dark-500 flex items-center justify-center space-x-3 transition-colors">
        <i class="fa-solid fa-download text-white text-lg"></i>
        <span class="text-white font-medium">All</span>
      </button>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="bg-dark-700 rounded-2xl p-6 border border-dark-600 mb-6">
    <h3 class="text-lg font-semibold text-white mb-4">Quick Actions</h3>
    <div class="space-y-3">
      <button id="new-analysis-btn" class="w-full bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white font-semibold py-4 px-6 rounded-xl flex items-center justify-center space-x-3 transition-all duration-200">
        <i class="fa-solid fa-plus text-xl"></i>
        <span class="text-lg">New Analysis</span>
      </button>
      
      <button id="go-back-btn" class="w-full bg-dark-600 hover:bg-dark-600/80 text-gray-200 font-medium py-3 px-6 rounded-xl flex items-center justify-center space-x-3 transition-all duration-200">
        <i class="fa-solid fa-arrow-left text-lg"></i>
        <span>Go Back</span>
      </button>
    </div>
  </div>
</div>

<!-- Bottom Navigation -->
<div id="bottom-navigation" class="fixed bottom-0 left-0 right-0 bg-dark-800 border-t border-dark-600 px-6 py-3 pb-[env(safe-area-inset-bottom)]">
  <div class="flex items-center justify-between">
    <div class="flex items-center space-x-6">
      <div class="flex items-center space-x-2">
        <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
        <span class="text-xs text-gray-500">Step 1</span>
      </div>
      <div class="flex items-center space-x-2">
        <div class="w-2 h-2 bg-gray-600 rounded-full"></div>
        <span class="text-xs text-gray-500">Step 2</span>
      </div>
      <div class="flex items-center space-x-2">
        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
        <span class="text-xs text-green-400 font-medium">Step 3</span>
      </div>
    </div>
    <div class="text-xs text-gray-500">Whisper Results</div>
  </div>
</div>

<script>
/* ===================== WHISPER STEP 3: RESULTS & EXPORT ===================== */

(() => {
  // State management
  const state = {
    jobId: 'job_demo_001',
    duration: '2:34',
    processingTime: '7.2s',
    confidence: '94.7%',
    segments: 12
  };

  // Sample transcript data
  const transcriptData = {
    segments: [
      { start: '00:00', text: 'We launched the spring campaign with a focus on digital engagement.' },
      { start: '00:15', text: 'The results exceeded our expectations across all channels.' },
      { start: '00:32', text: 'Customer engagement grew by forty percent compared to last quarter.' },
      { start: '00:48', text: 'Social media interactions reached an all-time high.' },
      { start: '01:05', text: 'The campaign successfully increased brand awareness.' },
      { start: '01:22', text: 'We\'re planning to expand this strategy to other markets.' },
      { start: '01:38', text: 'The team is excited about the future opportunities.' },
      { start: '01:55', text: 'Thank you for watching our campaign overview.' }
    ],
    metadata: {
      jobId: state.jobId,
      duration: state.duration,
      processingTime: state.processingTime,
      confidence: state.confidence,
      segments: state.segments,
      language: 'English',
      createdAt: new Date().toISOString()
    }
  };

  // Bridge contract (if running in Android WebView)
  const hasBridge = typeof window.AndroidWhisper !== 'undefined';
  const bridge = hasBridge ? {
    async exportJson(jobId) { return window.AndroidWhisper.exportJson(jobId); },
    async exportSrt(jobId) { return window.AndroidWhisper.exportSrt(jobId); },
    async exportTxt(jobId) { return window.AndroidWhisper.exportTxt(jobId); },
    async exportAll(jobId) { return window.AndroidWhisper.exportAll(jobId); },
    async goBack() { return window.AndroidWhisper.goBack(); },
    async newAnalysis() { return window.AndroidWhisper.newAnalysis(); }
  } : {
    // Mock bridge for browser testing
    async exportJson(jobId) { 
      console.log('Mock: Exporting JSON for job:', jobId);
      return 'ok';
    },
    async exportSrt(jobId) { 
      console.log('Mock: Exporting SRT for job:', jobId);
      return 'ok';
    },
    async exportTxt(jobId) { 
      console.log('Mock: Exporting TXT for job:', jobId);
      return 'ok';
    },
    async exportAll(jobId) { 
      console.log('Mock: Exporting all formats for job:', jobId);
      return 'ok';
    },
    async goBack() { 
      console.log('Mock: Going back to previous step');
      if (window.AndroidInterface) {
        window.AndroidInterface.goBack();
      }
      return 'ok';
    },
    async newAnalysis() { 
      console.log('Mock: Starting new analysis');
      if (window.AndroidInterface) {
        window.AndroidInterface.openWhisperFileSelection();
      }
      return 'ok';
    }
  };

  // DOM Elements
  const backBtn = document.getElementById('back-btn');
  const copyTranscriptBtn = document.getElementById('copy-transcript-btn');
  const exportJsonBtn = document.getElementById('export-json-btn');
  const exportSrtBtn = document.getElementById('export-srt-btn');
  const exportTxtBtn = document.getElementById('export-txt-btn');
  const exportAllBtn = document.getElementById('export-all-btn');
  const newAnalysisBtn = document.getElementById('new-analysis-btn');
  const goBackBtn = document.getElementById('go-back-btn');

  // Utility functions
  function showToast(message, isError = false) {
    console.log(isError ? 'ERROR:' : 'SUCCESS:', message);
    // In a real app, you'd show a toast notification
  }

  function copyToClipboard(text) {
    if (navigator.clipboard) {
      navigator.clipboard.writeText(text).then(() => {
        showToast('Copied to clipboard');
      }).catch(() => {
        showToast('Failed to copy', true);
      });
    } else {
      // Fallback for older browsers
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      try {
        document.execCommand('copy');
        showToast('Copied to clipboard');
      } catch (err) {
        showToast('Failed to copy', true);
      }
      document.body.removeChild(textArea);
    }
  }

  // Event handlers
  backBtn.onclick = async () => {
    try {
      await bridge.goBack();
    } catch (e) {
      console.error('Error going back:', e);
      showToast('Failed to go back', true);
    }
  };

  copyTranscriptBtn.onclick = () => {
    const transcriptText = transcriptData.segments
      .map(segment => `${segment.start} - ${segment.text}`)
      .join('\n');
    copyToClipboard(transcriptText);
  };

  exportJsonBtn.onclick = async () => {
    try {
      await bridge.exportJson(state.jobId);
      showToast('JSON export completed');
    } catch (e) {
      console.error('Error exporting JSON:', e);
      showToast('Failed to export JSON', true);
    }
  };

  exportSrtBtn.onclick = async () => {
    try {
      await bridge.exportSrt(state.jobId);
      showToast('SRT export completed');
    } catch (e) {
      console.error('Error exporting SRT:', e);
      showToast('Failed to export SRT', true);
    }
  };

  exportTxtBtn.onclick = async () => {
    try {
      await bridge.exportTxt(state.jobId);
      showToast('TXT export completed');
    } catch (e) {
      console.error('Error exporting TXT:', e);
      showToast('Failed to export TXT', true);
    }
  };

  exportAllBtn.onclick = async () => {
    try {
      await bridge.exportAll(state.jobId);
      showToast('All formats exported successfully');
    } catch (e) {
      console.error('Error exporting all:', e);
      showToast('Failed to export all formats', true);
    }
  };

  newAnalysisBtn.onclick = async () => {
    try {
      await bridge.newAnalysis();
    } catch (e) {
      console.error('Error starting new analysis:', e);
      showToast('Failed to start new analysis', true);
    }
  };

  goBackBtn.onclick = async () => {
    try {
      await bridge.goBack();
    } catch (e) {
      console.error('Error going back:', e);
      showToast('Failed to go back', true);
    }
  };

  // Initialize
  console.log('Whisper Step 3 initialized');
  showToast('Results loaded successfully');

})();

</script>

</body>
</html>